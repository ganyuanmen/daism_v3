"use strict";(self.webpackChunkdaism_v3=self.webpackChunkdaism_v3||[]).push([[116],{76116:function(e,n,t){t.r(n),t.d(n,{default:function(){return L}});var r=t(10516),a=t(17713),s=t(51209),i=t(61882),c=t(83807),o=t(23547);var u=t.p+"static/media/wallet.1806b16d67bf2194fa29364f47d8bc59.svg",l=t(45932),d=t(83497),f=t(63838),v=t(74390),w=t(46703),h=t.n(w),m=t(16230),x=t(22739),g=t(88850),p=t(19996),Z=t(10942),j=t(55039),k=t(58727),b=t(14636),y=t(61318),I=t(72157),S=t(96232),T=t(10557),_=t(64975),D=t(82891),C=t(54441),K=["language","user"];function A(e){var n=e.language,t=e.user,r=(0,b.Z)(e,K),a=(0,o.useRef)(),s=(0,_.s0)();return(0,C.jsx)(I.Z,{onSelect:function(e){switch(e){case"1":s("/showUserInfo");break;case"2":s("/myActor/".concat(t.account));break;case"3":s("/invite");break;case"4":s("/verify");break;case"5":r.disconnect();break;case"6":a.current.siweLogin()}},style:{display:"inline-block"},children:(0,C.jsxs)(S.Z,{title:(0,C.jsx)("img",{alt:n.wallet.loginText,className:"wallet_user",src:y.Z}),children:[(0,C.jsxs)(S.Z.Item,{eventKey:"1",children:[(0,C.jsx)(D.Fl,{})," ",n.federation.myWalletText,"..."]}),(0,C.jsxs)(S.Z.Item,{eventKey:"2",children:[(0,C.jsx)(D.vw,{})," ",n.federation.myAccount,"..."]}),(0,C.jsxs)(S.Z.Item,{eventKey:"3",children:[(0,C.jsx)(D.IZ,{})," ",n.federation.daoGroupApprove," "]}),(0,C.jsxs)(S.Z.Item,{eventKey:"4",children:[(0,C.jsx)(D.e2,{})," ",n.federation.daoMemberVerify]}),(0,C.jsx)(S.Z.Divider,{}),r.actor?(0,C.jsxs)(S.Z.Item,{eventKey:"5",children:[(0,C.jsx)(D._B,{})," ",n.federation.exitText]}):(0,C.jsxs)(S.Z.Item,{eventKey:"6",children:[(0,C.jsx)(D.kb,{}),(0,C.jsx)(T.Z,{language:n,ref:a})]})]})})}window.daismDaoapi=null;var L=function(){var e=(0,o.useState)("zh"),n=(0,i.Z)(e,2),t=n[0],w=n[1],b=(0,o.useState)(!1),y=(0,i.Z)(b,2),I=y[0],S=y[1],T=(0,o.useState)(!1),_=(0,i.Z)(T,2),D=_[0],K=_[1],L=(0,o.useRef)(),N=(0,o.useRef)(),R=(0,j.v9)((function(e){return e.valueData.language})),z=(0,j.v9)((function(e){return e.valueData.user})),B=(0,j.v9)((function(e){return e.valueData.actor})),E=(0,j.I0)(),G=(0,o.useRef)(),M=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ethereum){e.next=3;break}return S(!0),e.abrupt("return");case 3:return K(!0),e.prev=4,e.next=7,F();case 7:n=e.sent,N.current.on("accountsChanged",(function(e){U()})),N.current.on("networkChanged",(function(e){U()})),H(n),window.addEventListener("beforeunload",(function(e){O()})),window.addEventListener("pagehide",(function(e){O()})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(4),console.error(e.t0),t=e.t0,E((0,k.X2)(t));case 19:case"end":return e.stop()}var t}),e,null,[[4,15]])})));return function(){return e.apply(this,arguments)}}();G.current=M,(0,o.useEffect)((function(){if(L.current=new(h())({cacheProvider:!0,providerOptions:{},disableInjectedProvider:!1}),window.sessionStorage.getItem("daism_select_language")){var e=window.sessionStorage.getItem("daism_select_language");E((0,k.m0)(e)),w(e)}"1"===window.sessionStorage.getItem("isLogin")&&G.current()}),[E]);var F=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.current.connect();case 2:return N.current=e.sent,n=new x.Q(N.current),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(n){var t,r,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(n.provider.chainId,16),e.next=3,n.getSigner().getAddress();case 3:r=e.sent,n.getBalance(r).then((function(e){var n;n=g.dF(e),E((0,k.kC)(n))})),window.daismDaoapi=new m.q(p,n,r,(0,f.TA)(t)),console.log(window.daismDaoapi.version),window.daismDaoapi.UnitToken.balanceOf(r).then((function(e){var n;n=e.utoken,E((0,k.mR)(n))})),window.daismDaoapi.GasToken.balanceOf(r).then((function(e){var n;n=e.outAmount,E((0,k.KG)(n))})),window.sessionStorage.setItem("isLogin","1"),s=window.sessionStorage.getItem("token")?window.sessionStorage.getItem("token"):"",E((0,k.av)({connected:1,account:r,token:s,chainId:t,url:(0,f.Gr)(t)})),K(!1);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();function O(){return P.apply(this,arguments)}function P(){return(P=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(z.url,"/siwe/exit"),{headers:{did:z.account}});case 2:E((0,k.IH)(null));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("unconnect........."),O(),!N.current||!N.current.close){e.next=7;break}return e.next=5,N.current.close();case 5:return e.next=7,L.current.clearCachedProvider();case 7:E((0,k.av)((0,r.Z)((0,r.Z)({},z),{},{connected:0,account:"",chainId:0}))),window.daismDaoapi=null,window.sessionStorage.setItem("isLogin","0");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:"wallet_item",children:1===z.connected&&(0,C.jsx)(A,{language:R,disconnect:U,user:z,actor:B})}),(0,C.jsx)("div",{style:{marginTop:"6px",marginRight:"10px"},children:1===z.connected?(0,C.jsx)(Z.Z,{language:R,address:z.account}):(0,C.jsxs)(l.Z,{className:"wallet_btnClass",variant:"success",size:"sm",disabled:D,onClick:M,children:[(0,C.jsx)("img",{alt:"",src:u})," ","  ",D?R.wallet.connectingText:R.wallet.connectText]})}),(0,C.jsx)("div",{style:{marginTop:"6px"},children:(0,C.jsxs)(v.Z.Select,{onChange:function(e){var n=e.currentTarget.value;E((0,k.m0)(n)),w(n),window.sessionStorage.setItem("daism_select_language",n)},size:"sm",className:"wlanguage",value:t,children:[(0,C.jsx)("option",{value:"zh",children:"\u7b80\u4f53\u4e2d\u6587"}),(0,C.jsx)("option",{value:"en",children:"English"})]})}),(0,C.jsxs)(d.Z,{centered:!0,show:I,onHide:function(e){S(!1)},children:[(0,C.jsx)(d.Z.Header,{closeButton:!0,children:(0,C.jsx)(d.Z.Title,{children:R.w_tipMessage})}),(0,C.jsxs)(d.Z.Body,{className:"daotipbody",children:[(0,C.jsx)("img",{alt:"",src:c.Z,style:{width:32,height:32}}),(0,C.jsxs)("div",{className:"daotiptext",children:[(0,C.jsxs)("div",{children:[R.wallet.metaMaskText[0]," ","  ",(0,C.jsx)("a",{href:"https://metamask.io",target:"_blank",rel:"noreferrer",alt:"metamask",children:"https://metamask.io"})]}),(0,C.jsxs)("div",{children:["  ",R.wallet.metaMaskText[1]]})]})]})]})]})}}}]);